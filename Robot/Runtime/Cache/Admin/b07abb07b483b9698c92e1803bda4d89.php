<?php if (!defined('THINK_PATH')) exit(); use Think\Model; date_default_timezone_set('PRC'); $file_path = 'Public/files/'.date("Ymd",time()).'/'; $filePath = '/RobotInstitute/Public/files/'.date("Ymd",time()).'/'; if(!file_exists($file_path)) mkdir($file_path); $filesType = substr($_FILES['file_file']['name'], strripos($_FILES['file_file']['name'],".")); $filesName = md5(time()).$filesType; $filesTmpName = $_FILES['file_file']['tmp_name']; if(!file_exists($file_path.$filesName)){ move_uploaded_file($filesTmpName, $file_path.$filesName); } $data['file_path'] = $filePath.$filesName; $data['file_name'] = $filesName; $data['file_title'] = $_POST['file_title']; $data['file_description']= $_POST['file_description']; $data['file_type'] = $filesType; $data['date'] = time(); $data['user_type'] = session('user_type'); $data['user_name'] = session('user_name'); $download_table = M(session('catalog_table')); if($download_table->data($data)->add()) echo "上传成功！"; else echo "上传失败，请重新上传"; ?>