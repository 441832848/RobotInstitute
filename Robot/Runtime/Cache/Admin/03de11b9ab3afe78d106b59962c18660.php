<?php if (!defined('THINK_PATH')) exit(); use Think\Model; $album_table = M(session('catalog_table')); date_default_timezone_set('PRC'); $album_path = 'Public/images/'.session('catalog_table').'/'; $albumPath = '/RobotInstitute/Public/images/'.session('catalog_table').'/'; if(!file_exists($album_path)) mkdir($album_path); $album_length = $_POST['album_length']; $flag = false; for($i = 0; $i < $album_length; $i++){ $filesType = substr($_FILES['album_file'.$i]['name'], strripos($_FILES['album_file'.$i]['name'],".")); $filesName = md5(time()+$i).$filesType; $filesTmpName = $_FILES['album_file'.$i]['tmp_name']; if(!file_exists($album_path.$filesName)){ move_uploaded_file($filesTmpName, $album_path.$filesName); } $data['album_file'] = $albumPath.$filesName; $data['album_description']= $_POST['album_description']; $data['date'] = time(); $data['user_type'] = session('user_type'); $data['user_name'] = session('user_name'); if($album_table->data($data)->add()) $flag = true; else $flag = false; } if($flag = ture) echo "上传成功！"; else echo "上传失败，请重新上传"; ?>